News event: Events for the versatile news system
Extension Key: roq_newsevent
Language: en
Version: 1.0.1 (rev. 14)
Keywords: forEditors, forAdmins, forBeginners, forIntermediates
Copyright 2006-2012, Jochem de Groot, <jochem@roquin.nl>

This document is published under the Open Content License
available from http://www.opencontent.org/opl.shtml

The content of this document is related to TYPO3 
- a GNU/GPL CMS/Framework available from www.typo3.org

Table of Contents
News event: Events for the versatile news system	1
Introduction	3
What does it do?	3
Screenshots	3
User's manual	5
About news event records	5
Administration	6
Archiving	6
RSS	6
iCalendar (ICS)	6
Configuration	8
Plugin	8
TypoScript reference	8
Database reference	9
Tutorial	10
General	10
How to add an event section to your site	10
Known problems	12
To-Do list	13
ChangeLog	14


Introduction
What does it do?
The news event extension extends the versatile news system extension with additional event functionality. The news event extension is based on Extbase and Fluid.
Screenshots
Image 1: News plugin with available Event views

Image 2: Mark a news record as event to add event data

Note: Only the settings which are applicable for news events are visible.
Image 3: Additional event data when editing a news record

Note: Only the settings which are applicable for news events are visible.
User's manual
About news event records
The records can be created on any page, however it is recommended to create a seperate sysfolder for news event records (next to a sysfolder in which you store your news records).
See the Tutorial section for more information about, how to use the news event extension.
News event records
Field:
Description:
Required:
Type
The type 'Event' has been added as an additional type to mark a news record as an event. If even has been selected an additional event tab will appear in which event information can be defined. See Image 2.
Yes
Start date
Start date of the event.
Yes
Start time
Start time of the event.
No
End date
End date of the event. This makes an event multiple days unless this date is the same as the start date. In this case you don't have to define the end date.
No
End time
End time of a the event.
No
Location
Location where the event takes place. For instance: Washington D.C.
No

Administration
Archiving
News records are archived by using the archive date restriction or time restriction settings. These settings are not used for news events records, and archiving for events works a bit differently. Events which are current or will occur in the future (based on the event data) are known as 'active', and all past events are known as 'archived'. You must select either 'active' or 'archived' when configuring an added news plugin for news events. See the section Configuration → Plugin for more information.
RSS
News event supports RSS feeds, which is handled like an event list view plugin. You can create an RSS feed exactly the same as adding an RSS feed for News. See the manual for the news system extension for more information. The default template for the output is stored in: Resources/Private/Templates/News/EventList.xml. 
The xml file type is achieved by setting:
plugin.tx_news.settings.format = xml
iCalendar (ICS)
Next to RSS, the news event extension also supports the iCalendar (ICS) format. See: http://en.wikipedia.org/wiki/ICalendar for more information about the iCalendar format.
The news event extension comes with two default ICS templates:
For listing all events (like the Event List view), which is located in: Resources/Private/Templates/News/EventList.ics;
per single event (like the Event Detail view), which is located in: Resources/Private/Templates/News/EventDetail.ics.
Both default templates use the same partial, which is located at: Resources/Private/Partials/Events/Item.ics. 
ICS support by embedding the plugin with TypoScript
This section describes how you can create an ICS page for all and/or single events on your website by using TypoScript. 
ICS for all events
See the TypoScript below as an example in which all active events are shown:
page = PAGE
page {
	typeNum = 9828
	10 < tt_content.list.20.news_pi1
	10 {
		switchableControllerActions {
			News {
				1 = eventList
			}
		}
		settings {
			format = ics
			archiveRestriction = active
	            	startingpoint = [sysFolderID]
		}
	}

config {
	disableAllHeaderCode = 1
	xhtml_cleaning = none
	admPanel = 0
	disablePrefixComment = 1
	metaCharset = utf-8
	additionalHeaders = Content-Type:text/calendar;charset=utf-8
}

As shown in the TypoScript above a the string Content-Type:text/calendar;charset=utf-8 will be added to the HTTP header with the additionalHeaders setting, which causes the ICS page to be interpret as an iCalendar file. 
Because of this, the ICS data can be included directly into the website user's local calendar (like Apple iCal, Google Calendar, Microsoft Outlook etc.). Depending on the browser, the website user will be prompted with a pop-up box if the current event should be added to his or her local calendar.
ICS for single events
If you want to create a single ICS per event, you can use the same TypoScript code as above, but you'll need to set the controller action to eventDetail instead of eventList: 
SwitchableControllerActions {
	News {
		1 = eventDetail
	}
}

You could include a typolink to a single event ICS on your single event matching the corresponding event, so that a visitor can add the event directly to his or her local calendar.
RealURL configuration for ICS
If you use RealURL for speaking URL's, you can include the following code in your RealURL configuration for your ICS pages:
$TYPO3_CONF_VARS['EXTCONF']['realurl'] = array(
	'_DEFAULT' => array(
		'fileName' => array(
			'defaultToHTMLsuffixOnPrev' => true,
            	'index' => array(
				'eventlist.ics' => array(
					'keyValues' => array(
						'type' => 9828,
					),
				),
				'event.ics' => array(
					'keyValues' => array(
						'type' => 9829,
					),
				),			
			),
		),
	),
);

Please make sure that the type matches the corresponding typeNum defined in your TypoScript. In this exampe the types 9828 and 9829 are used, but of course you can use your own type numbers. This is also applicable to the name of the pages, which are eventlist.ics and event.ics.
Configuration
Plugin
The news event extension adds three additional views. Next to these views, some other settings will work a bit differently comparing to the news system. See the table below for an explanation of these settings:
Property:
View:
Description:
Key:
What to display
All
Selection of view:
Event List view: List of all news event records which fit the configuration
Event Detail view: Shows the complete news event record
Event Date menu: Date menu based on the dates (by default  years) of news event records
-
Sort by
None
Define the sorting of displayed news records.

This field will be ignored. This setting can only be configured by using Typoscript configuration, see the TypoScript reference for more information.
orderBy

Sort direction
None
Define the sorting direction which can either be ascending or descending.

This field will be ignored. Sorting will be handled by the 'Sort by' setting, which can be overridden by using Typoscript configuration, see the TypoScript reference for more information.
orderDirection
Archive
Event List view, Event Date menu
Next to 'No constraint', two modes are available:

Only active (non archived)
All current and future news event records (based on event dates and time) are shown.

Archived
All news event records with event dates in the past are shown.

Note: News (event) records can hold an optional archive date. This archive date in news event records will be ignored, and only the archive restriction as described above will be used.
archiveRestriction
Date field to use
Date menu
The date menu builds a menu by year and month and the given news records.

This field will be ignored. By default the field 'EventStartdate' will be used as dateField, and can be overridden by using Typoscript configuration, see the TypoScript reference for more information.
dateField

See the news system documentation for a description of all plugin settings.
TypoScript reference
This section describes additional news system TypoScript settings, which are available for news events. These settings are divided into:
General news settings, which are defined by using: plugin.tx_news.settings.<property>
Specific event settings, which are defined by using: plugin.tx_news.settings.event<property>
A simple way to get to know the default settings is to look at the file EXT:roq_newsevent/Configuration/TypoScript/setup.txt
News settings (iCal support)
Property:
Data type:
Description:
Default:
format
string
Set a different format for the output. Use e.g. “ics” for iCalendar “xml” or for RSS feeds.
html
News event settings
Property:
Data type:
Description:
Default:
orderBy
string
Field ordering, which is used to sort event records
tx_roqnewsevent_startdate ASC, tx_roqnewsevent_starttime ASC
archived.orderBy
string
Field ordering, which is used to sort archived event records
tx_roqnewsevent_startdate DESC, tx_roqnewsevent_starttime DESC
dateField
string
Field to use for dateMenu
EventStartdate
Database reference
This section describes the news event database fields, which are added to the news table 'tx_news_domain_model_news' to store all event data.
Additional database columns
Property:
Data type:
Description:
Required:
tx_roqnewsevent_startdate 
int(11)
The event start date
Yes
tx_roqnewsevent_starttime
int(11)
The event start time
No
tx_roqnewsevent_enddate
int(11)
The event end date (for multiple day events)
No
tx_roqnewsevent_endtime
int(11)
The event end time
No
tx_roqnewsevent_location
varchar(255)
The location of the event
No



Tutorial
General
Since this extension extends the versatile news system extension, it is recommended to first read the news system documentation. All the described news system settings in this documentation apply to the news event extension as well, and this section only describes the additional event features of news event.
How to add an event section to your site
This section describes how to implement the extension news event in your TYPO3 installation.
Installation
Before you can install this extension, please make sure the news system extension (including the system extensions: Extbase and Fluid) has been installed. See the news system documentation for more information.
After the installation of the news system you can install the news event extension in the same way:
1. Switch to the module “Extension Manager”.
2. Get the extension from the Extension Manager (TER)
Preparation: Include static TypoScript
Be aware that before any plugin can be rendered in the frontend it is necessary to include the static TypoScript of news event. This is very easy:
1. Switch to the template module and to the your template record.
2. Add the news extension to the “Include Static” list.

Important: make sure that you include the news event static template after the news system static template!
Create news event records
Before any news events can be shown in the frontend they must be created by adding news event records:
1. Therefore, create a new sysfolder and switch to the list view (it is preferable to create a seperate sysfolder for news event records next to your news records to keep your records organized)
2. Optionally you can create a seperate news category for news events. See the news system documentation for more information.
3. Use the icon in the topbar “Create new record” and search for “News system” and its records. You should see “News”, “News category” and “News Tag”.  Click on “News”  to create a new news record. 
4. Select 'Event' within the selectbox below 'Type' (see: Image 2), and click on 'Ok' when the pop-up box appears (with the message: “This change will affect which fields...”). An additional tab, called 'Event' will appear.
5. Click on the 'Event' tab and fill in the necessary event date information (at least an event start date, which is required)

Add a plugin to a page
Add a new page (for instance 'Upcoming events') to which you can add the news system plugin. See the news system documentation to read more on how to add this plugin. When you have added the plugin to the newly created page, edit the plugin settings, and:
1. Change the 1st select box from 'What to display' to 'List view' beneath the 'Event' section in the select box.
2. Select 'Only active (non archived)' below 'Archive' to only show all current and future events. Past events will be shown if 'Archived' has been selected. You can use this on a seperate page (on which you've added the plugin as well) to create an event archive section.
3. Point the starting point to the sysfolder pid where you have stored the news event records.
4. Save the plugin.
Optionally, you can create a seperate event detail and list page, as described in the news system documentation (see section: 'Add a plugin to a page'). In the example above the list view and detail view is the same page. Because of this the plugin setting 'Show a single news record' has been left empty.
Viewhelpers
Every Fluid ViewHelper starts with <f:. and you can always check out the code at typo3/sysext/fluid/Classes/ViewHelpers/. As an example the ViewHelper <f:link.page can be found at typo3/sysext/fluid/Classes/ViewHelpers/Link/PageViewHelper.php.
Any other ViewHelper from other extensions can be used by using a namespace declaration like:
{namespace e=Tx_RoqNewsevent_ViewHelpers}

Then ViewHelpers of EXT:RoqNewsevent (which can be found in roq_newsevent/Classes/ViewHelpers) can be used with the prefix e:.

Known problems
Please let me know if you have any suggestions, tips, or questions about the news event extension. Further progress, and other information can be found at TYPO3 forge: http://forge.typo3.org/projects/extension-roq_newsevent.
The bugtracker at http://forge.typo3.org/projects/extension-roq_newsevent/issues holds all known bugs of the news event extension. 
If you think you have found a bug, please report (if not already done) at TYPO3 forge and attach at least those information to make it as easy as possible to resolve it:
Understandable title & description: Please use English and include how the bug can be reproduced
Version of: TYPO3, news system version, and news event
If possible an attached patch would be very nice!
To-Do list
See the roadmap section on Forge: http://forge.typo3.org/projects/extension-roq_newsevent/roadmap

ChangeLog
Version
Changes:
2.0.1
Native support for more languages, and some minor fixes 
2.0.0
Initial version

